# Introduction

To finish this lesson off,we're going to be converting our program into a web app using Sinatra.As you can see here, I have a file called web_guess_the_number.rb,which contains all our code.Let's take a look at it now.Now for this program,we'll need to keep note of the information after each request.Such as the number that needs to be guessed by the player.The HTTP protocol the web uses is stateless,which means that information isn't stored between each request.One way to get around this is to use sessions.And this is really easy to do in Sinatra.You just need to add this line here at the start, enable sessions.This will use cookies to store information.You need to be aware that these are not secure and can be intercepted anddecrypted by a hacker.It's not so much of a problem in this case, as it's only a game, butdo keep this in mind if you ever plan to store sensitive information in the future.In the next part of the program we create this route handler here,which will be accessed when the player goes to the page with the URL /guess.This sets up the game by using the session to store a random numberfrom one to 100 and the number of attempts.As I mentioned earlier,we use sessions to store information throughout the life of the program.Otherwise, the information will be lost after each request.To do this, we use the session hash that you can see here.And it's used to store any information that goes in the session.You just need to write session with square brackets, andthe name afterwards starts with a colon.And that is like a variable, butit will be stored throughout the life of the program.So here we're storing the number, and we assign thatto a random number from one to one hundred using the rand method we met earlier.And in this line we set up an attempt session variable andwe initialize it to zero.

# Instance Variables

After this, we define what's called an instance variable called message.Instance variables always start with the ampersand symbol, as you can see here.And they're available in the view that's associated with the rand handler.At the end of the rand handler we call the view called guess hereusing the erb method.In this view, this string here that's assigned to the instancevariable message will be available to be shown in the view.Let's go and have a look at that view.Remember, views go at the end of the fileafter the end declaration that we can see here.The view name comes after the double ampersand you can see here,and it's called guess.Remember we called the view using the erb method followed by the name guess.This is a basic webpage and it contains a form for submitting the guess.And we can see here the reference to the instance variable message.When we use erb, we can use a special tag,like you can see here, that is used to evaluate Ruby.These tags have a percentage sign andan equals sign at the beginning, and finish with just a percentage symbol.Any Ruby code that goes inside these tags will be evaluated andthen outputted in the HTML.So in this case,the string that is stored in the message instance variable will be displayed.

# Testing the Code

Let's go into the browser now and take a look at this running.I've already started a server.As you can see here if look in the terminal, it's already running.So if I go into my browser we can see what the web page looks like.And if I just take a look at the URL as usual it's localhostwith a port of 4567 and the route was /guess.Now, you can see the message here.And that was the string that was stored in the instance variable called message.And it's been outputted in HTML from that special Ruby tag.This input box here is from the form that was in our view,and I'm just going to enter a guess of 50.But before I go ahead and submit this form, let's go back to the code andhave a look what happens when the form is submitted.

# Postback

Now, if we look into the form, we can see these attributes here.And this is telling us that when the form is posted,we're going to use the HTTP method POST.And we're also going to provide a route where it will be posted to,using this action attribute here.And we're actually going to post it to the same route.We're going to call it /guess.In this case this is called what's called a postback andit's when you post a form to the same URL of where the form is located.In this case, this URL here, /guess.That was the same URL where we got the form from and it's going to post the formto exactly the same URL, but it's going to use a different method.Remember when we got the page we used the get method andnow this line here is going to ensure we use the post method.Notice in these input fields We have a name attributecalled number, here.And this is the value that will be stored in the params hashwhen the form is posted.So now we need to create a route handler that deals with thisform when it is posted.And you can see that up here.We use the post method here,because the post method was used in the form.So the route handler needs to start with post instead of get.So this will deal with, this route handler here, will deal with when the formis posted, whereas the earlier route handler here,will deal with when we just get the webpage /guess.So, now we're dealing with this route handler after the form is posted.And first of all, we can see that we create a variable called number andwe assign it to the session variable that we created before.That was the random number created by the game earlier.Then we grab the guess from the form that was submitted in the input box andas I mentioned this will be stored in the params hashusing the same name as was in the name attribute in the form.It was number.Now, all values submitted by a form,will be submitted as strings and we want it to be a number.So at the end we're going to have to use the to_i methodto convert it to an integer.We're also going to increase the number of guesses that have been made and

# Redirect Method

these are stored in the session under the session variable of attempts.And we're going to use the same notation we used before, with this += symbol,and it's followed by a 1, so this would increase the value by 1.After this, we use an if statement to redirect toa success page if the guess is equal to the number.You can see that in this line here.And we use Sinatra's built in redirect and to method.They work together here.And we put there a URL that we want to redirect to.And these built in methods make it a very easy statement to read.Reads just like English.We want to redirect to this URL here.It's a good example of naming methods in a clever way, sothat the Ruby code reads very much like an English sentence.And what this will do is, you can just read this line of code,it will redirect to this URL /success if the guess is equal to the number.Remember, it's two equal signs if you want to check forequality instead of assigning a value.If the user isn't redirected, then their guess must have been wrong.

# Else If Logic

So, we then use some if and elsif logic in this block of code here,to test if the guess was too big or too small.And in the first line here, we check if the guess was too small, andwe update The message instance variable herewith a new message that says too small, try again.And if that's not the case, if the guess is too big,then we'll update the message instance variable to say too big and try again.And we finish off In the last line here using the ERB method once againto display another view called guess.This is the same view that we had before, the form will be displayed again,and all that will change is this instance variable messagewill be different depending whether the guess was too small or too big.And the player will be able to make another guess.Now, the paragraph that contains the message instance variablehere will be different, depending on how the player made the guess.Even though we're using the same view.And this is what makes instance variables such a useful tool.You can change their value but still use the same view, over andover again, to show different information.

# Route Handler

Now, all there's left to do,is to create the route handler to deal with a successful guess.This will just be a get request, andit has the route /success that we can see here.Now in this route handler, the first thing we do is create a variablecalled attempts, and we assign this the value that's held in the session variablethat's been keeping track of the attempts throughout the life of the program.Then we display a congratulatory messagethat informs the user of how many attempts it took.And this string here is actually the same stringthat we used in our previous program.Let's go back into the browser now and take a look at all this in action.So, I'm now going to click on this button and what this will do is post the form.

# Fixing an Error

When I click on that, weget an error message from Sinatra cause it doesn't know this ditty.And that's because I just need to go back, and save my code.I just save.Save that file here, and if you ever make any changes to the code,

# Restart the Server

you just need to restart the server.And the way you do that, is you hold down Ctrl and C,that stops the server, as you can see there in the terminal,and restart again by typing ruby and name of the file,which was web_guess_the_number.rb, in this case.

# Testing

If we go back into the browser and I'm just going to reload the page,enter my guess of 50 at this time when I click guess,it should post the form to the correct URL.We can see here that the message, instance variable, has been updated.And we now have a new message that says, too small, try again.So I should try a bigger number.Let's try 60.And click again and it's still too small.So just click here.We can see it's still the same URL, because we're using a postback, andwe keep using the same URL each time.It almost acts like a loop, continually posting the pageto the same URL until I make a correct guess and the loop will be broken.And let's keep trying until I do make a correct guess.Still too small.Still too small, 80, so try 90.Still too small.95 is still too small, try 99.Which is too big, go back to 97.And there we can see, once I've finally guessed the correct number,we've been directed to a new route with a URL we can see here of /success.And the message instance there, the message that's displayedhere is the well done message that was in that route handler.Hopefully you now know all about numbers andlogic, as well as how to use sessions to store information on the web.

# Next Lesson

In the next lesson we're going to take a look at containers, such as arrays andhashes, and how to perform loops.In the meantime, have a play around with what we've covered so far.And be sure to leave any questions or comments below.