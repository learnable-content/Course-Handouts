Introduction

Hi, and welcome to the final video in this series.In this video we'll be applying what we've learned about classesto the Play Your Cards Right game.
Deck.rb

Now as you can see here, I've created a file called deck.rb.But inside this file I'm going to create a couple of classes.One to model cards and one to model the deck of cards.And this first class you can see here is the cards supply.And first of all we can see that it has an initialized method thatwill be run every time we create a new card.Now this has two parameters.The name of the card, that might be ace, 2, 3, or jack, queen, king.And the suit.So hearts, diamonds, spades, or clubs.And we take those parameters andwe use them to set these two instance variables here.Name and suit.They will be used to keep trackof those facts about the cards throughout the class.Remember, instance variables can be accessed in any methodinside of this class.And the methods that we give to the card class are going to be one method calleddescription.And we can see that here, this just returns this string that usesstring interpolation to just describe the card as a sentence, soit might say something like the 2 of clubs.We also have a method called value.Now, this just reuses some of the logic that we used earlier to getan actual numerical value of each card based on it's name.So for example, we use the case statement here and we take the first letter.This notation here is the first letter of the name instance variable andif it's Jack then we give it a value of 11, Queen 12, King 13.Otherwise we just change the value to an integer using the to_i method.And that's exactly the same as the logic that we usedin the earlier version of the game.We've just extracted this into its own class.
IRB

Now, let's just pop into IRB and have a look at this working.Now if I open up the terminal to IRB, andthe first thing I need to do is require this file.So it's in my home directory,which is the same directory I've just opened the terminal from.I just need to type deck.rb andwe can see the true say as that's been required now soI can access that class definition and its methods.And we find now create a new card and do let's assign it to the variable a.We use card.new.And this will run the initialize method, so I need two arguments.And let's go for the Ace of Spades.And we can see now a new card object is being created.And it's got these two instance variables here.Name is Ace, and the suit is Spades.And let's just test out those other two methods we had.So we referred to that object with a variable that's been assigned to,that's a, so we just need to enter a.description,and we should get a description of the card here.We get that string returned, The Ace of Spades andthe value actually returns 0.Remember, the value of an ace should be one, really.But in this case,we don't really mind because we're just playing a game of higher or lower.And we just need the Ace to be lower than all the other cards.Well in other circumstances, if you wanted to reuse this class for another game,then we might have to just touch that up and improve the definition there.That method that gets the value of each card, so the Aces return one instead.Let's try a different card.Let's create a King andlet's go forthe King of Hearts.We can see that's being created there.We can see as the object, and if we just test out the methods,we can see it's description.King of hearts, and the value for a king should be 12.So we just check, sorry 13, 12 for queens.And that's working perfectly fine.
Deck Class

Let's just jump back into the class definitions down here andnow let's take a look at the deck class.So this is to model an actual deck of cards andit actually uses the card objects from the card class we've just created.So first of all, we've got this initialize method.It doesn't have to take any parameters.What it does do is it uses this instance variable called cards,which stores an array of all the cards in the deck and it starts off an empty array.And then we use very similar logic to what we've been using already in our play yourcards right game, and this creates one array forthe suits and one for the names of the cards.And then we loop through both of those and each time we pusha new card object into this instance variable of cards, which is an array.So we store each new card object in the array and we do that.In the past, we just pushed a string in described the card.Now because we have our new Card class,we actually create a new Card object and put it into the array.So each item in the array is actually a Card object, and we'll see that in action.In a minute.And you can see we're just using the same notation we used in IRB just now,except we just use this generic name andsuit, which is being pulled from the loop that we're running through.So it'll take through each of these from these arrays here.
Shuffle Method

And then we've just got two methods for the deck of cards.We've got a shuffle method which actually just piggy backs on the shuffle methodthat the array uses.Now remember the cards instance variable is an array.So we just use that shuffle method.But we use the bang method.So it makes sure once the cards are shuffled in the deck.Then they stay shuffled.And we have another method called draw.This will draw a card from the deck of cards.And again, we piggyback on the array, pop method.So we just use that.And that will return the last item in an array.And it will actually take it out of the array as well.So it does pretty much everything we want.It takes the card out of the deck of cards, and it returns that card.So we just need that notation there.So these methods, even though they basically just use array methods, theyjust make them sound a bit more what we'd expect when we're using a deck of cards.Now if we just pop back into my RB we can see this in action.
Deck.new

So if I just create a variable called cards and create a new deckusing Deck.new, we'll see the initialize function will run.And it actually returns that card's instance variable whichis a big array,which we'll see now.And you can see inside this array, the array finishes there.We've actually got a load of card objects rather than just a load ofstrings like we've had before.These are all individual objects, and we can see they've all gone in order andit finishes with the king of spades.So what we need to do now is shuffle our cards.And we can use the shuffle method.And we can see this returns the deck of cards again.So a big, giant array, but this time they're in a random order.We can see now, the last card object hereis the seven of diamonds, and they're all in a completely random order.Just to check that we can draw a card from a pack, we do cards.draw,then we see it has returned that last card, the seven of diamonds.And if I just try that again, I'll assign it to the variable card,cards.draw.Now, this card, the eight of diamonds,is assigned to the variable card, and we can just check that it works inthe same way as the card objects we're looking at before.So just to prove that they are card objects stored inside that array,it has the description method, and it should have a value of 8.Let's have a look.And yes it does.Now we've got our two classes workingas we want them to, we can now use them in our Play Your Cards Right game.
Refactoring Your Code

And what I've done here, if I go back into my text editor,I've actually copied the last code that we used, so I haven't changed any of it yet,but I've changed and I've saved it as a different name.The last one was version 2.I've saved this as play your cards right, v3.So this is going to be version 3.I'm just going to run through the changes that you need to make, andwhat we'll see here is by using, by extracting the logic into a separatecards class, this will drastically cut down on the amount of code that we usein the game logic, and it will also make the game logic a bit clearer.So the first thing we need to do at the top here is to requirethat file that we've just created, and it's called, we need ./,cause it's in the same directory, and it was called deck.We don't need the .rb extension here.Once we've got that, then we can change some of these helper methods.Now, the first one is very obvious.In this set_up_game method we have actually basically created our own deckand assigned it to the session variable deck.We don't need to do that anymore, because we can just use deck.new, andmost of this logic is in the deck class, so we can take all of that out here.And we just need to make one more change, and this shuffle was using the actualarray method, because the deck earlier was just an array.Now it's it's own class, and the shuffle method doesn't have the bang on the end.So we can just remove that, and the next method,we were using this to grab the values of different cards.Now, the cards were just displayed as strings before, now we have our own cardobjects, they actually have their own value method built in, sowe don't need this one as well, so we can remove that.Now, there are still some changes we need to make to the helper methods,but what I'm going to do is just jump down to the ramp handlers.And if we move down here, we've got a few changes to make to those first, andthen we'll come back and just edit some of the helper methods.So first of all the root route here that we start with.Doesn't actually change.We're still going to use the set_up_game helper method.And we're still going to redirect to this URL here, /play/cards.But it's this route handler here that we can make some changes to.And the biggest one is what we're going to do is when we set thiscard variable here, we're actually going to make it an instance variable.And this will mean we can actually use it throughout our Sinatra application,because actually, the Sinatra application runs off its own class.
Using Instance Variables as Views

So any instance variables that are used can actually then be referred toin all the different methods that we use in our Sinatra application.And that's actually why instance variables can be used in views as well,it's a clever trick.They work in the same way as we were using them throughout class,because the Sinatra application is its own class.So if I make this an instance variable, it means I can now refer to it insidethe helper methods, and it will actually mean I don't need to enter the card asa argument to those methods, which may look a bit clunky in some other methods.And I don't need this draw_card method anymore.What I need to do is take our session variable,and use the built in draw method, which we set up before.And I don't need to refer to the value anymore.We'll just use the value method, soI can just completely remove that statement there.And now we get onto the logic of the game.We've got this if player_has_a_losing value.Now, value was the value of the card, andwe were entering that as an argument to this method.We don't actually need to do this anymore,cause we can just use the value method of the card instance variable.So I'm just going to change this to if player_loses,change the name of the method, and the same reason, we don't actually need toenter an argument to the game_over method anymore, so I can remove that, so thisjust makes it a bit more terse and even more straightforward to follow.If the player loses, it's game over.Or else, we're going to update the session.And, again, I don't need to put this value argument in, and soI don't really need that word with on the end, sowe'll just update the session, and then I do want to ask about the card.
ask_about_card Method

Now, card doesn't actually need to be an argument, sowe'll just actually change the name of the method to call it ask_about_card.And now we can see this little bit of logic really does make quite a lotof sense.If the player loses, game over, or else update the session and ask about the card.So let's go and have an update of those methods.Now, we need to take those parameters out.So if we just go back up here, we can see the method here,player_has_a_losing value.We actually changed that to just call it player_loses.Now, we just need to make sure, inside here we were referring to this variablecalled value, which was passed in as a parameter.We actually now want to look at the instance variable card, andits value method.And that will give us the value of the card,instead of having to pass it into the method itself.Same here, just change that to card.value.
Built-In Draw Method

Now, this next method, draw_card, we don't need anymore, because wehave a draw method built into our deck class, so that can just be removed.And now the game over method, was just changed.We don't need the parameter anymore.So we can remove that.It's just called game over.And where this card was referred to,earlier it was an argument that was entered, we can just.What we actually want is a description of the card to go into this string.And we use the description method of the card instance variable.The rest of the string just stays the same as it was before.The next method, update_session_with, we change this,we don't want that value parameter on the end or the word with.So we're just going to call this update_session.And we just need to make sure we actuallyupdate it with the card.value method.Not just the value.It would have been an argument.And last of all, we just call this, ask about card.So, we don't need the parameter anymore.And all we're going to do is again, we want this to be the card's description.So it just makes a bit more sense as it's a bit more readable to saycard description goes here, using this string interpolation, andagain, the rest of the string just stays the same.And now we're back to our route handlers.Now we can see we have cut down quite drastically the amount ofcode we've got in here and it's much more readable.
Running the Game

So if I just save this and what I'm going to do is go back into my terminal.I get out of IRB by pressing exit and I'm just going to run that code.I run it by ruby and this should start server,play_your_cards_right and that one was version 3 I've just created.We press enter.I forgot to put .rb on the end, we do need it when running from the terminal,so .rb and we can see now the server has started.So I can just test this quickly by goinginto the browser and entering,we picked a localhost:4567.Press enter.And we can see we've got the card the 6 of Spades.Will it be higher or lower?That's a tough one to start with.I'll go higher.Jack of Diamonds.Lower. 10 of Clubs, so just lower.Go lower again.Now we've got Game Over, and you managed to make two correct guesses.Play again. We'll just check tosee if that link works.And it does.
End of Lesson

Starts us over, all over again.Now you might be thinking that once again we haven't actuallychanged the functionality of our game.But we have really improved the program.We've already looked at how we've got less lines of code, andwe've been able to neaten up the syntax to make it even more readable.But what we've also done is we've managed to improve the program by separating itinto some self contained classes.We've taken a lot of the logic out and this makes it a much more flexibleapproach because we can now use our deck and card classes in other programs.So we might have another card game we want to use them in andwe can port them over and just use that drop those classes in anduse them in a different program making the old program more flexible.And then if we improve those classes then we can bring them back tothe improved classes and use them in this game as well.So, our code is now much more reusable.And we've done that because they're not as tightly coupled to the game logic anymore,so we can drop them in and take them out as we see fit.So I hope we found that useful.That concludes this last video.Thanks for sticking with the course.I really hope you've enjoyed it.