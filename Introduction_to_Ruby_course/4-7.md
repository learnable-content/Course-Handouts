Introduction

Now we're going to use the virtual deck of cards that we created in the last videoto recreate a web version of one of my favorite childhood game shows.I used to love watching Play Your Cards Right.Some of you may not have seen or heard of this show, soI've provided a clip in the resources section below.The basic idea, though, was that contestants had to guesswhether a randomly chosen card would be higher or lower than the previous card.
Coding Our Program

To get started, you'll need a file called play_your_cards_right.rb,like the one you can see here.Now, this app only uses two route handlers, butthey're quite complicated, so we'll take a look at each one in turn.The first route handler, as you can see here, uses the root URL.And this is indicated by the forward slash here after the get command.Now this route basically sets up the game by creating a deck of cards likewe did earlier.But this time we're going to store the deck in the session hash.And for that reason, we'll need to use enable :sessions at the start of the file.Going back to the route handler,we first of all set up a session hash with a nameof :deck, and we assign this a empty array.And then like we did before, we iterate over the list of suits and values andthen push a string representing each card into the deck in the session.And that's happening in this iterator here using the each method.And we can see for each value in suit,we push this string into this session variable called :deck here,and this will give us a full suit of cards, all inside the session.Once we've created this deck of cards and stored it in the session,we then use the shuffle method with a bang on the end to shuffle all the cards.And this will make them appear in a random order.Next, we create another session variable withthe key of guesses to store the number of guesses that the player has made.Now, this is set to -1 initially, as you can see here, which seems a bitodd at first, but I'll explain more about why we do this later on.
Sinatra's Helper Methods

Then we use Sinatra's helper methods, redirect andto, to redirect to the URL /play/cards.Now, we don't actually have a route handler for this route, we just havea generic route handler that uses a named parameter called play and then get.So it doesn't say /play/cards,but because it's a generic graph handler using this name parameter,this route that we just redirected to will be covered by this route handler here.So this is the next route handler that the player is passed on to.So let's have a look inside this route handler now and see what happens the firsttime the player gets automatically passed on when they start the game.First of all, we create a variable called card,and we use the pop method to take a card fromthe session that's stored in the deck variable,and this will store a string representinga card inside the variable called card.
Pop Method

Now, we need to get the value of this card,since the game is about guessing if a card is higher or lower.And to do this, we use this case statement here.And this will eventually store the value of the card in thisvariable here called value.To find out the value of the card,what we look at is the first letter of the string that's stored in the card variable.We do that using this notation here.This is similar to how we access each item in an arraywhere the counting starts at 0.So this represents the first character in a string.And what the case statement does is look and see if the first character is a J,then the card must be a jack, so we give it a value of 11.And if the first character is a Q,then the card must be a queen, so it gets a value of 12.And if it's a K, then it's a king and gets a value of 13.For all the other cards,the first character in the string will actually be its value.So for example, the four of hearts starts with a four.So, if you remember, in an earlier lesson when we were learning about numbers,we learned that the to_i method will convert a string into an integerequal to the first numerical value in that string.So in all these cases, for all the other cards,their actual value is equal to the first integer in the string.So we can just use this method to grab their value.And as an added bonus, this will also work for aces, because if a string doesn'tcontain any numbers at all, then this method will convert into 0,and even though we'd normally expect aces to have a value of 1, thisdoesn't actually matter because we're only testing if the cards are higher or lower.And as long as the ace has a lower value than all the other cards,then the game will still work.So, now we have a variable for the card, which is a string representation ofthe card, it might be the king of spades or four of diamonds,and we also have a variable that stores the value of the card.
IF Statement

We then enter a very big if statement that we can see here.It starts there, and finishes all the down at the bottom here.And basically, this is the nuts and bolts of the whole game.And what we're doing here is checking to seeIf the player has made an incorrect guess or a correct guess.It starts by checking what the value of the params[:guess] is, which usually,if the player has made a guess, will be set to higher or lower, but remember, thisis the first time we've hit this route, and it's right at the start of the game.So, initially, the value of thisparams hash here, will be nothing.It won't have a value.And this will mean thatthis won't get evaluated at all.And we won't see this game over message here.And it will jump straight to this section here,and what it will do is this will bump up the number of guesses by one.And if you remember earlier, we set the number guesses to -1.This is because when we go through the route handler the first time,the player hasn't actually made a guess.The game has just started, and you can see here that thiswill bump it up to 0, and this is where we want it to be for the start of the game.We'll also set that store the value of the cardin a session variable with the name of value.
Session Variable

And then we'll output this little block of HTML here.And this will display what the card is.We use some string interpolation here to write in the card, andwe've got some HTML and some links to say, do you want to choose higher or lower?And this will choose a link for the player to pick, and if you notice,the links here actually link back to the same routehandler that starts with play, but the named parameter will change.And this will be stored in the params[:guess] hash, andit will either be higher or lower.So, when the player clicks on one of these links,they'll be taken back to the start of this same route handler, andthe whole sequence will repeat again.A new card will be pickedfrom the session deck, and stored in the variable card.We'll then grab the value of this card, andthis time this if condition becomes important,because params[:guess] will either be higher orlower, depending on which link the player clicked on.So, one of these conditions will be true.Either the player picks higher andthe value is lower, or the player picked lower andthe value was bigger than before.And just to make sure we're not confused over these different values,the variable value is the value of the current card.The session variable of value here is the value of the previous card.And we're comparing those two.
Params

And if you can see, this first condition is saying the player picks higher,that is stored in the params[:guess] variable.But, the value of the current card is actually lower thanthe value of the previous card, which is stored in the session.Now, that's incorrect.This condition here is also incorrect.The player guessed lower, Butthe value of the current card is actually bigger than the previous card.So if either of those conditions are met, the player has guessed incorrectly.And in that case, this message will be displayed and the game will end.
Using Interpolation

It will say game over, and we'll use the session variable forthe number of guesses to display how many guesses using interpolation.And we'll also put a link for the player to play again, andthis will send them back to the root URL, it'd be just a forward slash.Now, if the player guesses correctly,then we hit the else part of this if statement.And this actually plays through like it does the first time through,because remember, the first time through, these conditions aren't met eitherpurely because this params[:guess] does not exist.And we also get to this part if the player's made a correct guess as well.And this increases the number of correct guesses andthen sets the value stored in the session to the current value, becausethis card is about to become the previous card, as the next card gets picked.And then we output this message again,giving the player the option to choose higher or lower.And this process will repeat over and over again, using the same route handler,until the player makes an incorrect guess, and they get the Game Over message.And once the game is played again, we go back to the route URL.
Playing the Game

Let's have a go at playing this.I've already started a server running, as you can see in the terminal here.So all I need to do is open up my browser, and as you can see,the address is localhost:4567/play.This is because I have been redirected to the play URL.Now, if I choose, let me see, the nine of clubs,I think the next card's going to be lower.Now if I click on this link, then I was correct, because I've got a new card.And if we look again, we can see the URL is lowerLet's see the seven of diamonds, I'm going to pick higher time.Now, it's actually going to use the same route handler,even though the route is different.And you can see that I've made an incorrect guess andI get the game over message now.And here tells me I managed to maketwo correct guesses and it gives me the chance to play again.And this time, when I click on play again, it redirects me to the root URL,and it resets the whole game, by creating a new deck of cards and shuffling them soI get a different card to start with, and I can play again.And there we go.
End of This Lesson

That brings us to the end of this lesson.Collections and loops are a very powerful part of any programming language.And there aren't many Ruby programs that won't include some sort of iterator.In the next lesson, we're going to be looking how to write your own methods.